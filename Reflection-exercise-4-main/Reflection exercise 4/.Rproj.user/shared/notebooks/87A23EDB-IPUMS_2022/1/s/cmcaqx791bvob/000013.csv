"0","#| echo: false"
"0","#| warning: false"
"0","#| message: false"
"0",""
"0","# Load necessary libraries"
"0","library(dplyr)"
"0","library(readr)"
"0","library(tibble)"
"0","library(knitr)"
"0",""
"0","# Load the dataset"
"0","data <- read_csv(""usa_00004.csv"")"
"1","[1mRows: [22m[34m3373378[39m [1mColumns: [22m[34m14[39m
"
"1","[36mâ”€â”€[39m [1mColumn specification[22m [36mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m
[1mDelimiter:[22m "",""
[32mdbl[39m (14): YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER, STATEICP, STRATA, GQ, PERNUM, PERWT, SEX, EDUC, EDUCD
"
"1","
[36mâ„¹[39m Use `spec()` to retrieve the full column specification for this data.
[36mâ„¹[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.
"
"0","# Define the code for a doctoral degree (EDUCD = 116)"
"0","doctoral_educd_code <- 116"
"0",""
"0","# 1. Calculate the actual number of respondents in each state using PERWT"
"0","actual_respondents <- data %>%"
"0"," group_by(STATEICP) %>%"
"0"," summarise(actual_total_respondents = sum(PERWT)) %>%"
"0"," as_tibble()"
"0",""
"0","# 2. Calculate the number of respondents with doctoral degrees in each state using EDUCD"
"0","doctoral_respondents <- data %>%"
"0"," filter(EDUCD == doctoral_educd_code) %>%"
"0"," group_by(STATEICP) %>%"
"0"," summarise(doctoral_count = sum(PERWT)) %>%"
"0"," as_tibble()"
"0",""
"0","# Set the correct STATEICP code for California (71)"
"0","california_state_code <- ""71"""
"0",""
"0","# Ensure that we have doctoral degree holders in California"
"0","california_doctoral_respondents <- doctoral_respondents %>%"
"0"," filter(STATEICP == california_state_code) %>%"
"0"," pull(doctoral_count)"
"0",""
"0","# Debugging step: Check if california_doctoral_respondents has a valid value"
"0","print(california_doctoral_respondents)"
"1","[1]"
"1"," 516430"
"1","
"
"0","# Check for empty result and stop if necessary"
"0","if (length(california_doctoral_respondents) == 0) {"
"0"," stop(""Error: No doctoral respondents found for California. Check STATEICP or dataset."")"
"0","}"
"0",""
"0","# Define the total number of respondents in California"
"0","california_total_respondents <- 391171"
"0",""
"0","# Calculate the ratio for California (doctoral degree holders / total respondents)"
"0","california_ratio <- california_doctoral_respondents / california_total_respondents"
"0",""
"0","# 3. Use this ratio to estimate the total number of respondents in each state"
"0","state_estimates <- doctoral_respondents %>%"
"0"," mutate(estimated_total_respondents = doctoral_count / california_ratio)"
"0",""
"0","# 4. Merge the estimated totals with the actual totals"
"0","comparison <- state_estimates %>%"
"0","  left_join(actual_respondents, by = ""STATEICP"") %>%"
"0","  mutate("
"0","    difference = estimated_total_respondents - actual_total_respondents,"
"0","    percentage_error = (difference / actual_total_respondents) * 100,"
"0","    estimated_total_respondents = round(estimated_total_respondents, 0),"
"0","    difference = round(difference, 0),"
"0","    percentage_error = round(percentage_error, 0)"
"0","  )"
"0",""
"0","#show result"
"0","#print(comparison %>%"
"0","#  select(STATEICP, doctoral_count, estimated_total_respondents, actual_total_respondents, difference, percentage_error))"
"0",""
"0","# Display the comparison result in a more readable format"
"0","#print(comparison)"
"0",""
"0","# Results and Comparison"
"0",""
"0","# Displaying the final comparison with relevant columns"
"0","comparison %>%"
"0","  select(STATEICP, doctoral_count, estimated_total_respondents, actual_total_respondents, difference, percentage_error) %>%"
"0","  knitr::kable("
"0","    col.names = c("
"0","      ""State Code"", ""Doctoral Count"", ""Estimated Total Respondents"","
"0","      ""Actual Total Respondents"", ""Difference"", ""Percentage Error"""
"0","    ),"
"0","    caption = ""Comparison of Estimated vs Actual Respondents by State"""
"0","  )"
"2","Registered S3 methods overwritten by 'htmltools':
  method               from         
  print.html           tools:rstudio
  print.shiny.tag      tools:rstudio
  print.shiny.tag.list tools:rstudio
"
"2","Registered S3 method overwritten by 'rmarkdown':
  method         from
  print.paged_df     
"
